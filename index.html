<!doctype html>

<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Loss Recovery - FINAL (Updated)</title>
  <style>




body {
  margin:0;
  font-family:'Segoe UI', Roboto, Arial, sans-serif;
  background:#000;
  color:#e5e5e5;
  text-align:center;
  min-height:100vh;
  font-weight:700 !important;
  overflow-y:auto !important;
}
h1,h2,h3,p,td,th,label,div,span {
  color:#e5e5e5 !important;
  font-weight:700 !important;
  letter-spacing:0.5px;
  text-shadow:none !important; /* removed glow */
}
.page {
  max-height:85vh;
  overflow-y:auto;
  background:rgba(0,0,0,0.4); /* lighter so background particles visible */
  border:1px solid rgba(0,255,128,0.4);
  border-radius:12px;
  box-shadow:0 0 8px rgba(0,255,128,0.3);
  padding:20px;
}
.btn {
  padding:12px 24px;
  margin:10px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  color:#fff;
  font-weight:700;
  font-size:16px;
  background:linear-gradient(135deg,#16a34a,#22c55e);
  box-shadow:0 0 8px rgba(34,197,94,0.5);
  transition:all 0.3s ease;
  position:relative;
  overflow:hidden;
}
.btn:hover {
  background:linear-gradient(135deg,#22c55e,#16a34a);
  transform:scale(1.05);
  box-shadow:0 0 12px rgba(34,197,94,0.6);
}
.btn:active { transform:scale(0.96); }
canvas#particles {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  z-index:-1;
  background:#000;
}

h1,h2,h3,p,td,th,label,div,span {
  color:#e5e5e5 !important;
  font-weight:700 !important;
  letter-spacing:0.5px;
  text-shadow:0 0 4px rgba(0,255,128,0.5);
}
.page {
  max-height:85vh;
  overflow-y:auto;
  background:rgba(0,0,0,0.6);
  border:1px solid rgba(0,255,128,0.6);
  border-radius:12px;
  box-shadow:0 0 15px rgba(0,255,128,0.4);
  padding:20px;
}
.btn {
  padding:12px 24px;
  margin:10px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  color:#fff;
  font-weight:700;
  font-size:16px;
  background:linear-gradient(135deg,#16a34a,#22c55e);
  box-shadow:0 0 12px rgba(34,197,94,0.6);
  transition:all 0.3s ease;
  position:relative;
  overflow:hidden;
}
.btn:hover {
  background:linear-gradient(135deg,#22c55e,#16a34a);
  transform:scale(1.05);
  box-shadow:0 0 20px rgba(34,197,94,0.8);
}
.btn:active { transform:scale(0.96); }
canvas#particles {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  z-index:-1;
  background:#000;
}

h1,h2,h3,p,td,th,label,div,span {
  color:#00ff99 !important;
  font-weight:900 !important;
  letter-spacing:1px;
  text-shadow:0 0 8px #00ff99, 0 0 15px #00ffaa, 0 0 25px #00ffcc;
}
.page {
  max-height:85vh;
  overflow-y:auto;
  background:rgba(0,0,0,0.7);
  border:1px solid #00ffaa;
  border-radius:12px;
  box-shadow:0 0 20px rgba(0,255,170,0.7);
  padding:20px;
}
.btn {
  padding:12px 24px;
  margin:10px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  color:#000;
  font-weight:900;
  font-size:16px;
  background:linear-gradient(135deg,#00ffaa,#00ff99,#00cc88);
  box-shadow:0 0 20px #00ffaa,0 0 35px #00ffcc;
  transition:all 0.3s ease;
  position:relative;
  overflow:hidden;
}
.btn:hover {
  background:linear-gradient(135deg,#00ffcc,#00ffaa);
  transform:scale(1.08);
  box-shadow:0 0 30px #00ffaa,0 0 50px #00ffcc;
}
.btn:active { transform:scale(0.96); }
.btn::after {
  content:'';
  position:absolute;
  top:50%; left:50%;
  width:0; height:0;
  background:rgba(255,255,255,0.5);
  border-radius:50%;
  transform:translate(-50%,-50%);
  transition:width 0.6s ease,height 0.6s ease,opacity 0.8s ease;
  opacity:0;
}
.btn:active::after {
  width:200px; height:200px; opacity:0;
  transition:0s;
}
canvas#matrix {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  z-index:-1;
  background:#000;
}

@keyframes gradientBG {
  0% {background-position:0% 50%;}
  50% {background-position:100% 50%;}
  100% {background-position:0% 50%;}
}
h1,h2,h3,p,td,th,label,div,span {
  font-weight:900 !important;
  letter-spacing:0.6px;
  color:#fff !important;
  text-shadow:0 0 12px rgba(255,255,255,0.9),0 0 22px rgba(0,255,255,0.7);
}
canvas#particles {
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  z-index:-1;
}

@keyframes gradientBG {
  0% {background-position:0% 50%;}
  50% {background-position:100% 50%;}
  100% {background-position:0% 50%;}
}
.container {
  padding:20px;
  max-width:980px;
  margin:0 auto;
}
.page {
  display:none;
  padding:22px;
  background:rgba(255,255,255,0.05);
  border-radius:14px;
  backdrop-filter: blur(8px);
  box-shadow:0 8px 30px rgba(0,0,0,0.6);
}
.active {display:block;}
h1,h2,h3 {
  color:#38bdf8;
  text-shadow:0 0 12px rgba(56,189,248,0.8), 0 0 20px rgba(56,189,248,0.5);
}
#balanceBox {
  background: linear-gradient(135deg, #22c55e, #15803d);
  color:#fff;
  padding:12px 20px;
  border-radius:10px;
  display:inline-block;
  margin-bottom:15px;
  font-size:20px;
  font-weight:700;
  box-shadow:0 0 15px rgba(34,197,94,0.7), 0 0 25px rgba(34,197,94,0.5);
}
input[type=text], input[type=number] {
  padding:12px;
  border-radius:8px;
  border:none;
  outline:none;
  width:80%;
  max-width:420px;
  margin:10px 0;
  background:rgba(255,255,255,0.1);
  color:#fff; font-weight:bold; text-shadow:0 0 8px rgba(255,255,255,0.6);
  font-size:15px;
  box-shadow:inset 0 0 8px rgba(255,255,255,0.15);
}
table {
  width:100%;
  border-collapse:collapse;
  margin-top:12px;
  background:rgba(255,255,255,0.04);
  border-radius:10px;
  overflow:hidden;
}
th,td {
  padding:12px;
  border:1px solid rgba(255,255,255,0.1);
  font-size:14px;
  text-align:center;
  color:#e2e8f0;
}


.btn {
  padding: 12px 24px;
  margin: 8px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  background: linear-gradient(135deg, #3b82f6, #9333ea);
  color: #fff;
  font-weight: 600;
  font-size: 15px;
  transition: all 0.3s ease;
  box-shadow: 0 0 12px rgba(147,51,234,0.6), 0 0 20px rgba(59,130,246,0.5);
}
.btn:hover {
  background: linear-gradient(135deg, #9333ea, #3b82f6);
  transform: translateY(-2px) scale(1.03);
  box-shadow: 0 0 18px rgba(147,51,234,0.8), 0 0 28px rgba(59,130,246,0.7);
}
.btn:active {
  transform: translateY(1px) scale(0.98);
  box-shadow: 0 0 8px rgba(147,51,234,0.6), 0 0 16px rgba(59,130,246,0.5);
}

.plan {
  background: rgba(255,255,255,0.05);
  margin:10px;
  padding:15px;
  border-radius:12px;
  cursor:pointer;
  transition: all 0.3s ease;
  font-weight:bold;
  box-shadow:0 0 8px rgba(255,255,255,0.3);
}
.plan:hover {
  transform: scale(1.05);
  box-shadow:0 0 15px rgba(255,255,255,0.7);
}
.plan.selected {
  background: linear-gradient(135deg, #facc15, #f97316);
  color:#000 !important;
  font-weight:900;
  box-shadow:0 0 20px rgba(250,204,21,0.9), 0 0 30px rgba(249,115,22,0.8);
  transform: scale(1.08);
}

.btn {
  position: relative;
  overflow: hidden;
}
.btn::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  background: rgba(255,255,255,0.4);
  border-radius: 100%;
  transform: translate(-50%, -50%);
  transition: width 0.6s ease, height 0.6s ease, opacity 1s ease;
  opacity: 0;
  pointer-events:none;
}
.btn:active::after {
  width: 300px;
  height: 300px;
  opacity: 0;
  transition: 0s;
}
h1,h2,h3 {
  background: linear-gradient(90deg, #fff, #38bdf8, #9333ea, #facc15, #fff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-size: 300% 300%;
  animation: shine 6s infinite linear;
}
@keyframes shine {
  0% { background-position:0% 50%; }
  50% { background-position:100% 50%; }
  100% { background-position:0% 50%; }
}





body {
  margin:0;
  font-family:'Segoe UI', Roboto, Arial, sans-serif;
  background:#000;
  color:#e5e5e5;
  text-align:center;
  min-height:100vh;
  font-weight:700 !important;
  overflow-y:auto !important;
}
h1,h2,h3,p,td,th,label,div,span {
  color:#e5e5e5 !important;
  font-weight:700 !important;
  letter-spacing:0.5px;
  text-shadow:none !important; /* removed glow */
}
.page {
  max-height:85vh;
  overflow-y:auto;
  background:rgba(0,0,0,0.4); /* lighter so background particles visible */
  border:1px solid rgba(0,255,128,0.4);
  border-radius:12px;
  box-shadow:0 0 8px rgba(0,255,128,0.3);
  padding:20px;
}
.btn {
  padding:12px 24px;
  margin:10px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  color:#fff;
  font-weight:700;
  font-size:16px;
  background:linear-gradient(135deg,#16a34a,#22c55e);
  box-shadow:0 0 8px rgba(34,197,94,0.5);
  transition:all 0.3s ease;
  position:relative;
  overflow:hidden;
}
.btn:hover {
  background:linear-gradient(135deg,#22c55e,#16a34a);
  transform:scale(1.05);
  box-shadow:0 0 12px rgba(34,197,94,0.6);
}
.btn:active { transform:scale(0.96); }
canvas#particles {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  z-index:-1;
  background:#000;
}

h1,h2,h3,p,td,th,label,div,span {
  color:#e5e5e5 !important;
  font-weight:700 !important;
  letter-spacing:0.5px;
  text-shadow:0 0 4px rgba(0,255,128,0.5);
}
.page {
  max-height:85vh;
  overflow-y:auto;
  background:rgba(0,0,0,0.6);
  border:1px solid rgba(0,255,128,0.6);
  border-radius:12px;
  box-shadow:0 0 15px rgba(0,255,128,0.4);
  padding:20px;
}
.btn {
  padding:12px 24px;
  margin:10px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  color:#fff;
  font-weight:700;
  font-size:16px;
  background:linear-gradient(135deg,#16a34a,#22c55e);
  box-shadow:0 0 12px rgba(34,197,94,0.6);
  transition:all 0.3s ease;
  position:relative;
  overflow:hidden;
}
.btn:hover {
  background:linear-gradient(135deg,#22c55e,#16a34a);
  transform:scale(1.05);
  box-shadow:0 0 20px rgba(34,197,94,0.8);
}
.btn:active { transform:scale(0.96); }
canvas#particles {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  z-index:-1;
  background:#000;
}

h1,h2,h3,p,td,th,label,div,span {
  color:#00ff99 !important;
  font-weight:900 !important;
  letter-spacing:1px;
  text-shadow:0 0 8px #00ff99, 0 0 15px #00ffaa, 0 0 25px #00ffcc;
}
.page {
  max-height:85vh;
  overflow-y:auto;
  background:rgba(0,0,0,0.7);
  border:1px solid #00ffaa;
  border-radius:12px;
  box-shadow:0 0 20px rgba(0,255,170,0.7);
  padding:20px;
}
.btn {
  padding:12px 24px;
  margin:10px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  color:#000;
  font-weight:900;
  font-size:16px;
  background:linear-gradient(135deg,#00ffaa,#00ff99,#00cc88);
  box-shadow:0 0 20px #00ffaa,0 0 35px #00ffcc;
  transition:all 0.3s ease;
  position:relative;
  overflow:hidden;
}
.btn:hover {
  background:linear-gradient(135deg,#00ffcc,#00ffaa);
  transform:scale(1.08);
  box-shadow:0 0 30px #00ffaa,0 0 50px #00ffcc;
}
.btn:active { transform:scale(0.96); }
.btn::after {
  content:'';
  position:absolute;
  top:50%; left:50%;
  width:0; height:0;
  background:rgba(255,255,255,0.5);
  border-radius:50%;
  transform:translate(-50%,-50%);
  transition:width 0.6s ease,height 0.6s ease,opacity 0.8s ease;
  opacity:0;
}
.btn:active::after {
  width:200px; height:200px; opacity:0;
  transition:0s;
}
canvas#matrix {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  z-index:-1;
  background:#000;
}

.page {
  max-height: 85vh;
  overflow-y: auto;
}


h1,h2,h3 {
  font-weight:800 !important;
  background: linear-gradient(90deg,#3b82f6,#9333ea);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
#balanceBox {
  background: linear-gradient(135deg, #22c55e, #16a34a);
  color:#fff !important;
  font-size:20px;
  font-weight:800;
  border-radius:8px;
  padding:10px 18px;
  box-shadow:0 0 15px rgba(34,197,94,0.6);
}
.predictionResult {
  color:#3b82f6 !important; /* blue for prediction result */
  font-weight:800;
}
.confidence {
  color:#facc15 !important; /* yellow for confidence */
  font-weight:800;
}
.suggestedBet {
  color:#06b6d4 !important; /* cyan for suggested bet */
  font-weight:800;
}
.tipBox {
  color:#d1d5db !important; /* grey for tips */
  font-style:italic;
}
.winMsg {
  color:#22c55e !important; /* green for win */
  font-weight:800;
}
.lossMsg {
  color:#ef4444 !important; /* red for loss */
  font-weight:800;
}

</style>
</head>
<body id="body">
  <div class="container">
    <div id="welcome" class="page active">
      <h1>Welcome to Loss Recovery</h1>
      <p class="small">Aapka suagat hai — start recovery journey</p>
      <button class="btn" onclick="goLoss()">Next</button>
    </div><div id="loss" class="page">
  <h2>Enter your Loss Amount</h2>
  <input type="number" id="lossAmount" placeholder="Enter loss amount (₹)" />
  <div>
    <button class="btn" onclick="confirmLoss()">Confirm</button>
    <button class="btn" onclick="showPage('welcome')">Back</button>
  </div>
  <p class="hint">Example: 1000</p>
</div>

<div id="plan" class="page">
  <h2>Choose a Plan</h2>
  <div class="plans" id="plans"></div>
  <div>
    <button class="btn" onclick="goPayment()">Proceed to Payment</button>
    <button class="btn" onclick="showPage('loss')">Back</button>
  </div>
</div>

<div id="payment" class="page">
  <h2 id="planName"></h2>
  <p>Amount to Pay: ₹<span id="planPrice"></span></p>
  <img src="qr.png" class="qr" alt="QR Code"/>
  <p class="hint">Scan & pay using QR. Enter UTR below and submit for admin approval.</p>
  <input type="text" id="utr" placeholder="Enter UTR / Transaction ID" />
  <div>
    <button class="btn" onclick="submitUTR()">Submit for Approval</button>
    <button class="btn" onclick="showPage('plan')">Back</button>
  </div>
</div>

<div id="strategy" class="page">
  <h2>Recovery Strategy</h2>
  <div id="strategyContent"></div>
  <div id="strategyButtons"></div>
  <p class="small">Note: Strategy is locked until admin approves your payment. Admin will approve using the admin panel.</p>
</div>


<div id="predict" class="page">
  <h2>AI Prediction (WINGO 1-min)</h2>
  <p id="balanceBox" style="font-size:16px;font-weight:bold;color:#4ade80;">Balance: ₹0</p>
  <p class="small">Enter last 3-digit period number and last results sequence (Small/Big)</p>
  <input type="text" id="period" placeholder="Period (e.g., 123)" />
  <div class="hint">Example last 10: Small Big Small Big Big Big Small Big Small Big</div>
  <input type="text" id="last10" placeholder="Enter last results separated by space" />
  <div>
    <button class="btn" onclick="genPrediction()">Generate AI Prediction</button>
    <button class="btn" onclick="autoFillExample()">Fill Example</button>
  </div>
  <div id="predictionResult"></div>
  <div style="margin-top:12px">
    <button class="btn" onclick="handleRecord('win')">Win</button>
    <button class="btn" onclick="handleRecord('loss')">Loss</button>
    <button class="btn" onclick="showPage('strategy')">Back</button>
  </div>
  <div class="hint" style="margin-top:10px">AI remembers feedback locally to improve future suggestions.</div>
</div>


  </div>  <!-- Admin -->  <div id="adminPanel" style="display:none !important;">
    <h2>Admin Panel (Firebase)</h2>
    <div id="adminRequests" class="small">Loading requests...</div>
    <div style="text-align:right;margin-top:10px"><button class="btn" onclick="closeAdmin()">Close</button></div>
  </div>
  <div id="cross" style="display:none !important;">×</div><script type="module">
/* =======================
   Firebase & App Setup
   ======================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
import { getDatabase, ref, push, set, onValue, update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBs7eQyMrcN8kJWMHl2ac2UZHlYQ6DypD8",
  authDomain: "terminal-xxrr.firebaseapp.com",
  databaseURL: "https://terminal-xxrr-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "terminal-xxrr",
  storageBucket: "terminal-xxrr.firebasestorage.app",
  messagingSenderId: "722753278120",
  appId: "1:722753278120:web:bfa37aab39635a4e57f29d",
  measurementId: "G-E3MZH3E1K5"
};
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const db = getDatabase(app);

function saveUTRtoFirebase(utr, amount, deviceId, planDays, planLabel, loss){
  const utrRef = ref(db, 'utrRequests');
  const newRef = push(utrRef);
  set(newRef, {
    utr: utr,
    amount: amount,
    status: 'pending',
    deviceId: deviceId,
    planDays: planDays,
    planLabel: planLabel,
    loss: loss,
    time: Date.now()
  });
}

/* =======================
   Utility & UI helpers
   ======================= */
function speak(t){ try{ let u=new SpeechSynthesisUtterance(t); u.lang='hi-IN'; speechSynthesis.cancel(); speechSynthesis.speak(u);}catch(e){} }
function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  const bg={'welcome':'anime1.png','loss':'anime2.png','plan':'anime3.png','payment':'anime4.png','strategy':'anime5.png','predict':'anime4.png'};
  document.body.style.backgroundImage = "url('"+(bg[id]||'anime1.png')+"')";
}

/* =======================
   App State (local)
   ======================= */
let loss = parseFloat(localStorage.getItem('lossAmount') || '0');
let selectedPlan = null;
let planPrice = 0;
let baseBet = parseInt(localStorage.getItem('baseBet')||'0',10) || 0;
let martingaleCurrent = parseInt(localStorage.getItem('martingaleCurrent')||'0',10) || 0;
let deviceId = localStorage.getItem('deviceId') || (Math.random().toString(36).slice(2));
let balance = parseFloat(localStorage.getItem('balance')||'0');
let lossStreak = parseInt(localStorage.getItem('lossStreak')||'0',10);
localStorage.setItem('deviceId', deviceId);

// plan options
const plans = [
  {label:'3 Month',pct:7,days:90},
  {label:'1 Month',pct:12.5,days:30},
  {label:'1 Week',pct:15,days:7},
  {label:'3 Days',pct:20,days:3},
  {label:'1 Day',pct:25,days:1}
];

/* =======================
   Build Plans UI
   ======================= */
function buildPlans(){
  const box = document.getElementById('plans'); box.innerHTML='';
  plans.forEach(p=>{
    const price = (loss * p.pct / 100).toFixed(2);
    const div = document.createElement('div');
    div.className = 'plan';
    div.innerHTML = `<b>${p.label}</b><div class="small">Price: ₹${price}</div><div class="small">Duration: ${p.days} days</div>`;
    div.onclick = ()=>{
      document.querySelectorAll('.plan').forEach(x=>x.classList.remove('selected'));
      div.classList.add('selected');
      selectedPlan = p;
      planPrice = price;
      // store selected plan locally so it persists if user navigates
      localStorage.setItem('selectedPlanLabel', p.label);
      localStorage.setItem('selectedPlanDays', String(p.days));
      localStorage.setItem('selectedPlanPrice', String(price));
      speak('Apne '+p.label+' plan chuna. Price '+price+' rupaye');
    };
    box.appendChild(div);
  });
}

/* =======================
   User Flow: Loss -> Plan -> Payment -> UTR submit
   ======================= */
function goLoss(){ showPage('loss'); speak('Apna loss amount darj karein'); }
function confirmLoss(){
  const v = parseFloat(document.getElementById('lossAmount').value);
  document.getElementById('lossAmount').value = v; // ensure displayed correctly
  if(!v || v <= 0){ alert('Enter valid loss amount'); return; }
  loss = v;
  localStorage.setItem('lossAmount', String(loss));
  baseBet = Math.max(1, Math.round(loss * 0.05)); // base 5%
  balance = Math.round(loss * 0.10);
  updateBalanceDisplay();
  martingaleCurrent = baseBet;
  localStorage.setItem('baseBet', String(baseBet));
  localStorage.setItem('martingaleCurrent', String(martingaleCurrent));
  buildPlans();
  showPage('plan');
  speak('Apko apna loss kitne dino mai cover karna hai. Plan choose karein');
}
function goPayment(){
  // ensure we have latest selectedPlan from localStorage if page reloaded
  if(!selectedPlan){
    const label = localStorage.getItem('selectedPlanLabel');
    const days = parseInt(localStorage.getItem('selectedPlanDays')||'0',10);
    const price = localStorage.getItem('selectedPlanPrice');
    if(label && days){
      selectedPlan = {label:label,pct:0,days:days}; // pct not needed here
      planPrice = price || '0';
    }
  }
  if(!selectedPlan){ alert('Select a plan'); return; }
  document.getElementById('planName').innerText = selectedPlan.label;
  document.getElementById('planPrice').innerText = planPrice;
  showPage('payment');
  speak('QR scan karke '+planPrice+' rupaye ka payment karein.');
}
function submitUTR(){
  const utr = document.getElementById('utr').value.trim();
  if(!utr){ alert('Enter UTR'); return; }
  // ensure we have selected plan details
  const planDays = selectedPlan ? selectedPlan.days : parseInt(localStorage.getItem('selectedPlanDays')||'0',10);
  const planLabel = selectedPlan ? selectedPlan.label : localStorage.getItem('selectedPlanLabel') || 'Plan';
  // push to firebase with deviceId
  saveUTRtoFirebase(utr, planPrice, deviceId, planDays, planLabel, loss);
  alert('Payment submitted for approval. Admin will approve soon.');
  showPage('strategy');
  renderStrategyLocked(); // locked until approved
}

/* =======================
   Firebase: Admin side & User listen for approval
   ======================= */
// Admin panel will listen to all requests and show approve/reject buttons
const requestsRef = ref(db, 'utrRequests');
onValue(requestsRef, (snap)=>{
  const el = document.getElementById('adminRequests');
  if(!snap.exists()){ el.innerHTML = '<div class="small">No requests</div>'; checkUserApproval(null); return; }
  const data = snap.val();
  // build admin list with approve/reject
  let adminHtml = '<table><thead><tr><th>Key</th><th>UTR</th><th>Amt</th><th>DeviceId</th><th>Plan</th><th>Days</th><th>Status</th><th>Time</th><th>Action</th></tr></thead><tbody>';
  for(const k in data){
    const r = data[k];
    // show all requests (pending or not) so admin can see status
    adminHtml += `<tr>
      <td style="font-size:12px">${k}</td>
      <td>${r.utr || ''}</td>
      <td>₹${r.amount || ''}</td>
      <td style="font-size:12px">${r.deviceId || ''}</td>
      <td>${r.planLabel || ''}</td>
      <td>${r.planDays || ''}</td>
      <td>${r.status || ''}</td>
      <td style="font-size:12px">${r.time ? new Date(r.time).toLocaleString() : ''}</td>
      <td>
        ${r.status !== 'approved' ? `<button class="btn" onclick="adminApprove('${k}')">Approve</button>` : ''}
        ${r.status !== 'rejected' ? `<button class="btn" onclick="adminReject('${k}')">Reject</button>` : ''}
      </td>
    </tr>`;
  }
  adminHtml += '</tbody></table>';

  const infoHtml = `<div style='margin-top:15px;text-align:left;font-size:14px;line-height:1.5'>
    <b>📌 Step-by-Step Recovery Guide (Admin view):</b><br>
    1️⃣ हर दिन system आपके लिए target calculate करेगा.<br>
    2️⃣ आज का deposit amount और target ऊपर table में देखें.<br>
    3️⃣ Prediction page पर जाएं → Last 10 results डालें → "Generate AI Prediction" पर click करें.<br>
    4️⃣ हर bet के बाद "Win" या "Loss" button दबाकर result update करें.<br>
    5️⃣ जब आज का target पूरा हो जाए → status "Completed" दिखेगा और अगला दिन unlock होगा.<br>
    6️⃣ Plan पूरा होने पर आपका पूरा loss recover हो जाएगा ✅.<br>
  </div>`;

  el.innerHTML = adminHtml + infoHtml;

  // Also check if user's request changed (for current device)
  const myReqKey = findMyRequestKey(data);
  if(myReqKey) checkUserApproval({key: myReqKey, data: data[myReqKey]});
  else checkUserApproval(null);
});

function adminApprove(key){
  console.log('Approving request', key);
  if(!confirm('Approve this request?')) return;
  const node = ref(db, 'utrRequests/' + key);
  // Update only status and approvedAt. Do not fabricate other fields here.
  update(node, { status: 'approved', approvedAt: Date.now() }).then(()=>{
    alert('Request marked approved. User will see strategy on their device.');
    // Do not call checkUserApproval here with synthetic local data. The onValue listener will pick up the change and call checkUserApproval using real DB data.
  }).catch((e)=>{ alert('Approve failed: '+e.message); });
}
function adminReject(key){
  if(!confirm('Reject this request?')) return;
  const node = ref(db, 'utrRequests/' + key);
  update(node, { status: 'rejected', rejectedAt: Date.now() });
}

function findMyRequestKey(allData){
  if(!allData) return null;
  for(const k in allData){
    if(allData[k].deviceId === deviceId) return k;
  }
  return null;
}

/* =======================
   User: React to approval changes
   ======================= */
function checkUserApproval(req){
  // req = {key, data} or null
  if(!req){
    // no request for this device - show locked strategy
    renderStrategyLocked();
    return;
  }
  const data = req.data || req;
  if(data.status === 'approved'){
    // store approved info locally and build progressive targets
    localStorage.setItem('approvedRequestKey', req.key || '');
    localStorage.setItem('approved', 'true');
    // store selectedPlan details from firebase record if available
    if(data.loss) localStorage.setItem('lossAmount', String(data.loss));
    if(data.planDays) localStorage.setItem('planDays', String(data.planDays));
    if(data.planLabel) localStorage.setItem('planLabel', data.planLabel);
    // update local variables to reflect DB values exactly
    loss = parseFloat(localStorage.getItem('lossAmount') || '0');
    // now generate progressive targets and unlock strategy
    generateAndStoreTargets();
    renderStrategyUnlocked();
    return;
  } else if(data.status === 'rejected'){
    // show rejection message
    renderStrategyRejected();
    return;
  } else {
    // pending
    renderStrategyLocked();
  }
}

/* =======================
   Strategy: Progressive AP targets
   ======================= */
function generateAndStoreTargets(){
  // read loss and days (prefer local selected plan details)
  const l = parseFloat(localStorage.getItem('lossAmount') || '0');
  const days = parseInt(localStorage.getItem('planDays') || (selectedPlan ? selectedPlan.days : '0'), 10);
  if(!l || !days) return;
  // a = base first day target (safe): use baseBet or 3% of loss
  let a = Math.max(1, Math.round(l * 0.03)); // start with 3% of loss
  // Solve for d via AP sum: sum = n/2 * (2a + (n-1)d) = l
  let d = 0;
  if(days > 1) d = (2 * l / days - 2 * a) / (days - 1);
  else d = 0;
  // build targets and round
  let targets = [];
  let sum = 0;
  for(let i=0;i<days;i++){
    let t = Math.max(1, Math.round(a + i * d));
    targets.push(t);
    sum += t;
  }
  // adjust rounding difference
  const diff = Math.round(l - sum);
  if(diff !== 0){
    targets[targets.length - 1] += diff;
  }
  // store
  localStorage.setItem('dayTargets', JSON.stringify(targets));
  // day statuses
  const statusArr = Array.from({length: days}, (_,i) => 'Pending');
  localStorage.setItem('dayStatus', JSON.stringify(statusArr));
  localStorage.setItem('currentDay', '1');
  // also store planDays & planLabel if not present
  if(!localStorage.getItem('planDays') && selectedPlan) localStorage.setItem('planDays', String(selectedPlan.days));
  if(!localStorage.getItem('planLabel') && selectedPlan) localStorage.setItem('planLabel', selectedPlan.label);
}

/* Render strategy UI states */
function renderStrategyLocked(){
  const el = document.getElementById('strategyContent');
  el.innerHTML = `<p class="small">Your payment is pending admin approval. Submit UTR on Payment page and wait for admin.</p>`;
  document.getElementById('strategyButtons').innerHTML = `<div class="small">Pending approval... (Admin will approve in the Admin Panel)</div>`;
}
function renderStrategyRejected(){
  const el = document.getElementById('strategyContent');
  el.innerHTML = `<p style="color:#ffb4b4"><b>Payment rejected by admin. Contact admin.</b></p><div><button class="btn" onclick="showPage('payment')">Resubmit UTR</button></div>`;
  document.getElementById('strategyButtons').innerHTML = '';
}
function renderStrategyUnlocked(){
  const el = document.getElementById('strategyContent');
  const targets = JSON.parse(localStorage.getItem('dayTargets')||'[]');
  const dayStatus = JSON.parse(localStorage.getItem('dayStatus')||'[]');
  const currentDay = parseInt(localStorage.getItem('currentDay')||'1',10);
  const storedLoss = parseFloat(localStorage.getItem('lossAmount')||'0');
  if(!targets.length){ el.innerHTML = '<p class="small">Targets not generated yet.</p>'; return; }

  // prepare header and progress
  const completedCount = dayStatus.filter(s=>s==='Completed').length;
  const totalDays = targets.length;
  const progressPct = Math.round((completedCount/totalDays)*100);

  let html = `<div style='margin:10px 0'>
    <div style='background:#333;border-radius:8px;overflow:hidden;height:20px;width:100%'>
      <div style='background:#4ade80;height:100%;width:${progressPct}%;transition:width 0.5s'></div>
    </div>
    <p class='small'>Progress: ${completedCount}/${totalDays} days (${progressPct}%)</p>
  </div>`;

  html += `<p class=\"small\">Plan: ${localStorage.getItem('planLabel')||''} | Total Loss: ₹${storedLoss}</p>`;

  html += `<p class='small'>Your recovery strategy is divided into daily steps. Follow AI prediction each day until target achieved.</p>`;
  html += '<table><thead><tr><th>Day</th><th>Target (₹)</th><th>Deposit %</th><th>Status</th></tr></thead><tbody>';
  targets.forEach((t,i)=>{
    const idx = i+1;
    const st = (dayStatus[i] || 'Pending');
    const mark = (st === 'Completed' ? '✅ Completed' : (idx === currentDay ? '➡️ Current' : '⏳ Pending'));
    let depositPct = (idx===1?10:Math.round((t/Math.max(1,storedLoss))*100));
    html += `<tr><td>${idx}</td><td>₹${t}</td><td>${depositPct}%</td><td>${mark}</td></tr>`;
  });
  html += '</tbody></table>';

  html += `<div style='margin-top:15px;text-align:left;font-size:14px;line-height:1.5'>
    <b>📌 Step-by-Step Recovery Guide:</b><br>
    1️⃣ हर दिन system आपके लिए target calculate करेगा.<br>
    2️⃣ आज का deposit amount और target ऊपर table में देखें. (Day 1 deposit = 10% of loss)<br>
    3️⃣ Prediction page पर जाएं → Last 10 results डालें → "Generate AI Prediction" पर click करें.<br>
    4️⃣ हर bet के बाद "Win" या "Loss" button दबाकर result update करें—AI उसी हिसाब से सीखकर अगले prediction ठीक करेगा.<br>
    5️⃣ जब आज का target पूरा हो जाए → status "Completed" दिखेगा और अगला दिन unlock होगा.<br>
    6️⃣ Plan पूरा होने पर आपका पूरा loss recover हो जाएगा ✅.<br>
  </div>`;

  el.innerHTML = html;

  // buttons: start today's prediction or continue
  document.getElementById('strategyButtons').innerHTML = `<div style="margin-top:12px">
    <button class="btn" onclick="startTodayPrediction()">Start Today's Prediction (Day ${currentDay})</button>
    <button class="btn" onclick="resetPlanConfirm()">Cancel/Reset Plan</button>
  </div>`;
}

/* =======================
   Start prediction for current day
   ======================= */
function startTodayPrediction(){
  // ensure approved
  if(localStorage.getItem('approved') !== 'true'){ alert('Payment not yet approved.'); return; }
  // go to predict page
  showPage('predict');
  const currentDay = parseInt(localStorage.getItem('currentDay')||'1',10);
  speak('Day ' + currentDay + ' prediction start karen.');
}

/* =======================
   Balance Helpers
   ======================= */
function updateBalanceDisplay(){ const el=document.getElementById('balanceBox'); if(el) el.innerText='Balance: ₹'+balance.toFixed(2); localStorage.setItem('balance',balance.toFixed(2)); }

/* =======================
   AI Prediction (pattern logic reused from previous)
   ======================= */
let lastSuggestedBet = 0;
function parseSeq(text){
  if(!text) return [];
  const parts = text.trim().split(/\s+/).map(s=>{
    const a = s.toLowerCase();
    if(a.startsWith('b')) return 'Big';
    if(a.startsWith('s')) return 'Small';
    return null;
  }).filter(Boolean);
  return parts;
}
function computePatternPrediction(seq){
  const n = seq.length;
  if(n === 0) return {prediction:'Big', confidence:50, reason:'no-data'};
  const counts = {Big:0, Small:0};
  seq.forEach(x=>counts[x] = (counts[x]||0)+1);
  let last = seq[n-1];
  let streak = 1;
  for(let i=n-2;i>=0;i--){ if(seq[i]===last) streak++; else break; }
  let alternations = 0;
  for(let i=1;i<n;i++){ if(seq[i] !== seq[i-1]) alternations++; }
  const alternationRatio = alternations / Math.max(1, n-1);
  let score = {Big:0, Small:0};
  if(counts.Big > counts.Small) score.Big += 1;
  if(counts.Small > counts.Big) score.Small += 1;
  if(alternationRatio < 0.4) score[last] += 2;
  else if(alternationRatio > 0.6) score[last] += 1;
  if(streak >= 4){
    const other = last === 'Big' ? 'Small' : 'Big';
    score[other] += 3;
  } else if(streak >= 2){ score[last] += 1; }
  if(n >= 4){
    const last4 = seq.slice(-4).join(' ');
    if(/^(Big Small Big Small|Small Big Small Big)$/i.test(last4)){
      const next = last === 'Big' ? 'Small' : 'Big';
      score[next] += 2;
    }
    if(/^(Big Big Small|Small Small Big)$/i.test(last4)){
      const next = last === 'Big' ? 'Small' : 'Big';
      score[next] += 1;
    }
  }
  let prediction = 'Big';
  if(score.Small > score.Big) prediction = 'Small';
  else if(score.Big > score.Small) prediction = 'Big';
  else {
    if(streak >= 3) prediction = (last === 'Big' ? 'Small' : 'Big');
    else prediction = (counts.Big >= counts.Small ? 'Big' : 'Small');
  }
  let confidence = 50;
  const diff = Math.abs(score.Big - score.Small);
  confidence += Math.min(30, diff * 10);
  if(streak >= 4) confidence += 10;
  if(alternationRatio > 0.7) confidence += 5;
  confidence += Math.min(10, Math.abs(counts.Big - counts.Small) * 2);
  confidence = Math.max(50, Math.min(95, Math.round(confidence)));
  let reason = `counts: B${counts.Big}/S${counts.Small}, streak:${last}x${streak}, alt:${Math.round(alternationRatio*100)}%`;
  return {prediction, confidence, reason, score};
}
function genPrediction(){
  const last10Text = document.getElementById('last10').value.trim();
  const seq = parseSeq(last10Text);
  if(seq.length < 3){ alert('Enter at least 3 recent results (ideally 10).'); return; }
  const period = document.getElementById('period').value.trim();
  const res = document.getElementById('predictionResult');
  res.innerHTML = `<p class="small">AI analyzing trends... (8-12 sec)</p>
                   <div class="chip">Period: ${period || 'N/A'}</div>`;
  setTimeout(()=>{
    const out = computePatternPrediction(seq);
    // suggested bet = martingaleCurrent or base
    

lastSuggestedBet = 0;
    let suggestedBet = 0;
if(lossStreak === 0){ suggestedBet = Math.round(balance * 0.15); }
else if(lossStreak === 1){ suggestedBet = Math.round(balance * 0.30); }
else { suggestedBet = Math.round(balance * 0.55); }
if(suggestedBet <= 0) suggestedBet = baseBet;
    lastSuggestedBet = suggestedBet;


    res.innerHTML = `<h3><span class='predictionResult'>Prediction:</span> ${out.prediction}</h3>
                     <p class="small"><span class='confidence'>Confidence:</span> <b>${out.confidence}%</b></p>
                     <p class="small">Reason: ${out.reason}</p>
                     <p class="small"><span class='suggestedBet'>Suggested Bet:</span> <b>₹${suggestedBet}</b></p>
                     <p class="small"><span class='tipBox'>Tip:</span> Martingale doubles on loss, resets on win.</p>`;
    // store prediction history locally
    const hist = JSON.parse(localStorage.getItem('predictionHistory')||'[]');
    hist.push({time:Date.now(), period:period||null, seq:seq.slice(-10), pred:out.prediction, conf:out.confidence});
    if(hist.length > 300) hist.shift();
    localStorage.setItem('predictionHistory', JSON.stringify(hist));
    speak('Agla result hone ki sambhavna hai ' + out.prediction + ' confidence ' + out.confidence + ' percent');
  }, 10000);
}

/* =======================
   Record result + day completion logic
   ======================= */



function handleRecord(outcome){
  const predDiv = document.getElementById('predictionResult');
  if(!predDiv.innerText || predDiv.innerText.trim()===''){ alert('Pehle AI prediction generate kijiye.'); return; }

  const hist = JSON.parse(localStorage.getItem('predictionHistory')||'[]');
  const lastEntry = hist.length ? hist[hist.length -1] : null;
  if(!lastEntry){ alert("No prediction found."); return; }

  let change = lastSuggestedBet;
  if(outcome==='win'){
    balance += change;
    martingaleCurrent = baseBet;
    lossStreak = 0; // reset streak
    predDiv.innerHTML += `<p>✅ <span class='winMsg'>✅ Win recorded</span>. Balance +₹${change.toFixed(2)}</p>`;
  } else {
    balance -= change;
    lossStreak++;
    predDiv.innerHTML += `<p>❌ <span class='lossMsg'>❌ Loss recorded</span>. Balance -₹${change.toFixed(2)}</p>`;
  }
  localStorage.setItem('martingaleCurrent', String(martingaleCurrent));
  localStorage.setItem('lossStreak', String(lossStreak));
  updateBalanceDisplay();

  // Update history field
  const field = document.getElementById('last10');
  const cur = parseSeq(field.value);
  cur.push(outcome==='win'? lastEntry.pred : (lastEntry.pred==='Big'?'Small':'Big'));
  field.value = cur.slice(-10).join(' ');
  predDiv.innerHTML += `<p class="small">History updated: ${field.value}</p>`;
  lastEntry.outcome = outcome;
  localStorage.setItem('predictionHistory', JSON.stringify(hist));

  
  // ✅ Dynamic target popup check
  let currentDay = parseInt(localStorage.getItem('currentDay')||'1',10);
  let dayStatus = JSON.parse(localStorage.getItem('dayStatus')||'[]');
  let targets = JSON.parse(localStorage.getItem('dayTargets')||'[]');

  if(targets.length && currentDay <= targets.length){
    let nextTarget = targets[currentDay-1];

    if(balance >= nextTarget){
      alert(`🎉 Day ${currentDay} Target Completed! (Target = ₹${nextTarget})`);
      showPage('strategy');
      if(dayStatus.length) dayStatus[currentDay-1] = 'Completed';
      localStorage.setItem('dayStatus', JSON.stringify(dayStatus));
      localStorage.setItem('currentDay', String(currentDay+1));
      renderStrategyUnlocked();
      showPage('strategy');
    }
  }

}




/* =======================
   Reset/Cancel functions
   ======================= */
function resetAll(){
  localStorage.removeItem('dayTargets');
  localStorage.removeItem('dayStatus');
  localStorage.removeItem('currentDay');
  localStorage.removeItem('approved');
  localStorage.removeItem('approvedRequestKey');
  localStorage.removeItem('planDays');
  localStorage.removeItem('planLabel');
  localStorage.removeItem('lossAmount');
  localStorage.removeItem('baseBet');
  localStorage.removeItem('martingaleCurrent');
  localStorage.removeItem('predictionHistory');
  localStorage.removeItem('selectedPlanLabel');
  localStorage.removeItem('selectedPlanDays');
  localStorage.removeItem('selectedPlanPrice');
  // redirect to welcome
  alert('Plan reset. Back to start.');
  showPage('welcome');
}
function resetPlanConfirm(){
  if(confirm('Are you sure you want to cancel/reset this plan? This will clear local progress.')) resetAll();
}

/* =======================
   Admin UI open/close & Approve helpers
   ======================= */
function openAdmin(){
  const pass = prompt('Enter Admin Password to open panel:');
  if(pass === '456'){
    document.getElementById('adminPanel').style.display = 'block';
  } else {
    alert('Wrong password');
  }
}
function closeAdmin(){ document.getElementById('adminPanel').style.display = 'none'; }

/* =======================
   Helpers: fill example
   ======================= */
function autoFillExample(){
  document.getElementById('period').value = 'yesterday-123';
  document.getElementById('last10').value = 'Small Big Small Big Big Big Small Big Small Big';
  speak('Example filled, ab Generate AI Prediction karo');
}

/* =======================
   Init UI on load
   ======================= */
(function init(){
  // if there's an approved request stored, render unlocked strategy; else locked
  if(localStorage.getItem('approved') === 'true' && localStorage.getItem('dayTargets')){
    showPage('strategy');
    renderStrategyUnlocked();
  } else {
    renderStrategyLocked();
  }
  // if loss already set, prefill
  const storedLoss = parseFloat(localStorage.getItem('lossAmount')||'0');
  if(storedLoss) {
    loss = storedLoss;
    // also prefill input on loss page
    const lossInput = document.getElementById('lossAmount'); if(lossInput) lossInput.value = loss;
  }
  updateBalanceDisplay();
  // build plans if loss known
  if(loss) buildPlans();
})();

/* Expose some functions for inline onclick usage */
window.goLoss = goLoss;
window.confirmLoss = confirmLoss;
window.goPayment = goPayment;
window.submitUTR = submitUTR;
window.genPrediction = genPrediction;
window.handleRecord = handleRecord;
window.openAdmin = openAdmin;
window.closeAdmin = closeAdmin;
window.resetPlanConfirm = resetPlanConfirm;
window.autoFillExample = autoFillExample;
window.startTodayPrediction = startTodayPrediction;

</script>
<canvas id="particles"></canvas>
<script>
const canvas=document.getElementById('particles');
const ctx=canvas.getContext('2d');
let w,h,particles=[];
function resize(){w=canvas.width=window.innerWidth;h=canvas.height=window.innerHeight;}
window.addEventListener('resize',resize);resize();
class Particle{
  constructor(){this.reset();}
  reset(){this.x=Math.random()*w;this.y=Math.random()*h;this.vx=(Math.random()-0.5)*0.6;this.vy=(Math.random()-0.5)*0.6;this.size=Math.random()*2+1;this.alpha=Math.random()*0.6+0.4;}
  update(){this.x+=this.vx;this.y+=this.vy;if(this.x<0||this.x>w||this.y<0||this.y>h)this.reset();}
  draw(){ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fillStyle='rgba(255,255,255,'+this.alpha+')';ctx.fill();}
}
for(let i=0;i<120;i++)particles.push(new Particle());
function animate(){ctx.clearRect(0,0,w,h);particles.forEach(p=>{p.update();p.draw();});requestAnimationFrame(animate);}animate();
</script>


<audio id="clickSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>
<audio id="winSound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>
<audio id="lossSound" src="https://actions.google.com/sounds/v1/cartoon/clang.ogg" preload="auto"></audio>

<script>
function playClick(){document.getElementById('clickSound').play();}
function playWin(){document.getElementById('winSound').play();}
function playLoss(){document.getElementById('lossSound').play();}

// Attach click sound to all buttons
document.addEventListener('DOMContentLoaded',()=>{
  document.querySelectorAll('button').forEach(btn=>{
    btn.addEventListener('click', playClick);
  });
});

// Override handleRecord to include sounds
const _handleRecord = window.handleRecord;
window.handleRecord = function(outcome){
  _handleRecord(outcome);
  if(outcome==='win'){ playWin(); }
  else if(outcome==='loss'){ playLoss(); }
}
</script>


<canvas id="matrix"></canvas>
<script>
const canvas=document.getElementById('matrix');
const ctx=canvas.getContext('2d');
canvas.height=window.innerHeight;
canvas.width=window.innerWidth;
const letters='ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()*&^%';
const fontSize=14;
const columns=canvas.width/fontSize;
const drops=[];
for(let x=0;x<columns;x++) drops[x]=1;
function draw(){
  ctx.fillStyle='rgba(0,0,0,0.1)';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle='#00ff99';
  ctx.font=fontSize+'px monospace';
  for(let i=0;i<drops.length;i++){
    const text=letters.charAt(Math.floor(Math.random()*letters.length));
    ctx.fillText(text,i*fontSize,drops[i]*fontSize);
    if(drops[i]*fontSize>canvas.height&&Math.random()>0.975) drops[i]=0;
    drops[i]++;
  }
}
setInterval(draw,35);
window.addEventListener('resize',()=>{canvas.height=window.innerHeight;canvas.width=window.innerWidth;});
</script>


<canvas id="particles"></canvas>
<script>
const canvas=document.getElementById('particles');
const ctx=canvas.getContext('2d');
let w,h,particles=[];
function resize(){w=canvas.width=window.innerWidth;h=canvas.height=window.innerHeight;}
window.addEventListener('resize',resize);resize();

class Particle{
  constructor(){this.reset();}
  reset(){
    this.x=Math.random()*w;
    this.y=Math.random()*h;
    this.vx=(Math.random()-0.5)*0.6;
    this.vy=(Math.random()-0.5)*0.6;
    this.size=2;
  }
  update(){
    this.x+=this.vx; this.y+=this.vy;
    if(this.x<0||this.x>w||this.y<0||this.y>h) this.reset();
  }
  draw(){
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
    ctx.fillStyle='#22c55e';
    ctx.fill();
  }
}
function init(){particles=[];for(let i=0;i<80;i++){particles.push(new Particle());}}
function animate(){
  ctx.clearRect(0,0,w,h);
  for(let i=0;i<particles.length;i++){
    let p=particles[i]; p.update(); p.draw();
    for(let j=i+1;j<particles.length;j++){
      let p2=particles[j];
      let dx=p.x-p2.x, dy=p.y-p2.y;
      let dist=Math.sqrt(dx*dx+dy*dy);
      if(dist<120){
        ctx.beginPath();
        ctx.moveTo(p.x,p.y);
        ctx.lineTo(p2.x,p2.y);
        ctx.strokeStyle='rgba(34,197,94,'+(1-dist/120)+')';
        ctx.lineWidth=1;
        ctx.stroke();
      }
    }
  }
  requestAnimationFrame(animate);
}
init();animate();
</script>


<div id="suggestedBetBox" style="margin-top:20px; font-size:18px;"></div>
<div id="historyBox" style="margin-top:20px; font-size:16px;"></div>

<script>
let profitSoFar = 0;
let lastBet = 0;
let lastResult = null;
let dayTarget = 500; // default target, can be set dynamically

function calculateBet(balance, target, profitSoFar, lastBet, lastResult) {
  let remainingTarget = target - profitSoFar;

  // Target already done
  if (profitSoFar >= target) {
    return { bet: 0, message: "🎯 Target achieved ✅" };
  }

  // If last bet was loss → martingale double but safe capped at remaining target
  if (lastResult === "loss" && lastBet > 0) {
    let bet = Math.min(lastBet * 2, remainingTarget);
    return { bet: bet, message: "Martingale recovery bet" };
  }

  // Normal safe bet = 10% of remaining target
  let safeBet = Math.ceil(remainingTarget * 0.1);
  safeBet = Math.min(safeBet, remainingTarget);

  return { bet: safeBet, message: "Safe calculated bet" };
}

// Example integration after prediction is generated
function suggestBet(balance) {
  let result = calculateBet(balance, dayTarget, profitSoFar, lastBet, lastResult);
  document.getElementById("suggestedBetBox").innerHTML =
    "<span class='suggestedBet'>Suggested Bet: ₹" + result.bet + "</span><br>" +
    "<span class='tipBox'>" + result.message + "</span>";
  lastBet = result.bet;
}

// Call this when user records win/loss
function recordResult(outcome, betAmount) {
  lastResult = outcome;
  if(outcome === "win"){
    profitSoFar += betAmount;
    document.getElementById("historyBox").innerHTML += "<div class='winMsg'>Win +₹" + betAmount + "</div>";
  } else if(outcome === "loss"){
    profitSoFar -= betAmount;
    document.getElementById("historyBox").innerHTML += "<div class='lossMsg'>Loss -₹" + betAmount + "</div>";
  }
}
</script>


<script>
let currentDay = parseInt(localStorage.getItem("currentDay")) || 1;
let completedDay = parseInt(localStorage.getItem("dayCompleted")) || 0;

// Example day targets (can be dynamic per plan)
let dayTargets = {1:500,2:600,3:700}; 
let profitSoFar = 0;

function checkDayStatus() {
  if (completedDay >= currentDay) {
    document.getElementById("dayStatus").innerHTML = "✅ Day " + currentDay + " Completed";
    // Move to next day
    currentDay++;
    localStorage.setItem("currentDay", currentDay);
  } else {
    document.getElementById("dayStatus").innerHTML = "🎯 Target for Day " + currentDay + " = ₹" + (dayTargets[currentDay]||0);
  }
}

function completeDay() {
  completedDay = currentDay;
  localStorage.setItem("dayCompleted", completedDay);
  checkDayStatus();
}

// Call this when profit >= day target
function checkTargetCompletion() {
  let target = dayTargets[currentDay] || 0;
  if (profitSoFar >= target && target > 0) {
    alert("🎉 Day " + currentDay + " Target Completed!");
    completeDay();
  }
}

// Modify recordResult to check day completion
const _recordResultDay = window.recordResult;
window.recordResult = function(outcome, betAmount) {
  _recordResultDay(outcome, betAmount);
  checkTargetCompletion();
};

// Initialize UI
document.addEventListener("DOMContentLoaded", () => {
  if (!document.getElementById("dayStatus")) {
    let box = document.createElement("div");
    box.id = "dayStatus";
    box.style.marginTop = "20px";
    box.style.fontSize = "18px";
    document.body.insertBefore(box, document.getElementById("suggestedBetBox"));
  }
  checkDayStatus();
});
</script>

</body>
</html>
