<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AI Predictor — Target Bets (Demo)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#071022; --card:#0f1724; --muted:#9fb0d6; --accent1:#00d2a8; --accent2:#00a6ff;
    --glass: rgba(255,255,255,0.02);
  }
  *{box-sizing:border-box; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
  body{margin:0;background:linear-gradient(180deg,#061021,#07142a);color:#eaf6ff;padding:18px}
  .wrap{max-width:980px;margin:10px auto}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 10px 40px rgba(0,0,0,0.6)}
  header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:12px}
  header h1{font-size:18px;margin:0}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .plans{display:flex;gap:8px;flex-wrap:wrap}
  .planBtn{padding:8px 12px;border-radius:8px;border:none;background:transparent;color:var(--muted);cursor:pointer;border:1px solid rgba(255,255,255,0.04)}
  .planBtn.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#012;font-weight:800}
  .small{color:var(--muted);font-size:13px}
  input[type=text]{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
  .bigBtn{padding:10px 14px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#012;font-weight:800;cursor:pointer}
  .ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
  .grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  .resultCell{padding:10px;border-radius:8px;background:var(--glass);text-align:center;cursor:pointer;border:1px solid rgba(255,255,255,0.03)}
  .resultCell.active{box-shadow:0 8px 20px rgba(0,0,0,0.5);transform:translateY(-4px);border-color:var(--accent1)}
  .predictionBox{margin-top:12px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02)}
  .stat{font-weight:700}
  .historyList{max-height:160px;overflow:auto;padding:8px;border-radius:8px;background:rgba(0,0,0,0.12);margin-top:8px}
  .flex{display:flex;gap:8px;align-items:center}
  .right{margin-left:auto}
  .note{color:#ffdca8;font-weight:700;margin-top:8px}
  footer{margin-top:12px;color:var(--muted);font-size:13px;text-align:center}
  .overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:999;visibility:hidden;opacity:0;transition:.15s}
  .overlay.show{visibility:visible;opacity:1}
  .modalCard{background:#071326;padding:18px;border-radius:12px;min-width:320px}
  .smallMuted{color:var(--muted);font-size:13px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>AI Betting Advisor — Predict & Strategy Demo</h1>
      <div class="small">Minimal demo — local only</div>
    </header>

    <!-- Step 1: Plan choose -->
    <section class="card" id="step-plan">
      <h3>Step 1 — Choose Target Range (Plan)</h3>
      <div class="small">Pick a target (we'll suggest bets to reach target from your balance)</div>
      <div class="plans" id="plansRow" style="margin-top:12px">
        <!-- JS generates plan buttons -->
      </div>

      <div style="margin-top:12px" class="row">
        <div>
          <div class="small">Your starting balance (wallet):</div>
          <input type="text" id="inputBalance" value="100" style="width:120px" />
        </div>
        <div>
          <div class="small">Min bet per suggestion:</div>
          <input type="text" id="inputMinBet" value="10" style="width:120px" />
        </div>
        <div class="right">
          <button class="bigBtn" id="btnToAI">Next: Give last 10 results</button>
        </div>
      </div>
    </section>

    <!-- Step 2: enter last 10 -->
    <section class="card" id="step-history" style="margin-top:12px;display:none">
      <h3>Step 2 — Enter last results (manual)</h3>
      <div class="small">Click each cell to set Big / Small. Provide last 10 rounds (oldest -> newest from left to right)</div>

      <div class="grid3" id="historyGrid" style="margin-top:12px">
        <!-- 10 cells -->
      </div>

      <div style="margin-top:12px" class="row">
        <div class="smallMuted">Quick fill: <button class="planBtn ghost" id="fillRandom">Fill random</button></div>
        <div class="right">
          <button class="bigBtn" id="btnAnalyze">Analyze & Ask AI</button>
        </div>
      </div>
    </section>

    <!-- AI analysis & prediction -->
    <section class="card" id="step-ai" style="margin-top:12px;display:none">
      <h3>AI Analysis & Strategy</h3>
      <div class="small">AI will analyze pattern, trend and suggest action (Bet or Skip) with recommended amount and reason.</div>

      <div class="predictionBox" id="aiBox">
        <div id="aiSpinner" style="display:none">Thinking... (simulated)</div>
        <div id="aiResult" style="display:none">
          <div style="display:flex;align-items:center;gap:12px">
            <div>
              <div class="small">AI Suggestion</div>
              <div class="stat" id="aiSuggestion">—</div>
            </div>
            <div>
              <div class="small">Amount</div>
              <div class="stat" id="aiAmount">—</div>
            </div>
            <div>
              <div class="small">Confidence</div>
              <div class="stat" id="aiConfidence">—</div>
            </div>
            <div class="right">
              <button class="bigBtn" id="btnGeneratePrediction">Generate Prediction</button>
            </div>
          </div>
          <div style="margin-top:10px" class="smallMuted" id="aiReason">Reason...</div>
        </div>
      </div>

      <div style="margin-top:12px" class="row">
        <div>
          <button class="planBtn ghost" id="btnSkip">Skip this Round</button>
        </div>
        <div class="right">
          <div class="smallMuted">Balance: ₹<span id="wallet">0</span></div>
        </div>
      </div>

      <!-- Generated prediction -->
      <div id="predictionArea" style="margin-top:12px;display:none">
        <h4>Prediction</h4>
        <div class="small">Period: <span id="periodLabel">—</span></div>
        <div style="margin-top:6px">
          <div class="stat" id="predText">—</div>
          <div class="smallMuted" style="margin-top:6px">Use the buttons to inform the AI whether the prediction resulted in Win or Loss.</div>
        </div>

        <div style="margin-top:10px" class="row">
          <button class="bigBtn" id="btnWin">Win</button>
          <button class="planBtn ghost" id="btnLoss">Loss</button>
          <div class="right">
            <button class="planBtn ghost" id="btnBackToAnalyze">Back to Analyze</button>
          </div>
        </div>
      </div>

      <div style="margin-top:12px">
        <div class="smallMuted">Recent decisions & stats</div>
        <div class="historyList" id="recentDecisions"></div>
      </div>
    </section>

    <footer>Demo AI advisor — last results manual. All data stored locally.</footer>
  </div>

  <!-- modal -->
  <div class="overlay" id="modalOverlay">
    <div class="modalCard">
      <div id="modalTitle" style="font-weight:700;color:var(--accent1)"></div>
      <div id="modalSub" class="smallMuted" style="margin-top:8px"></div>
      <div style="margin-top:12px;text-align:right"><button class="planBtn ghost" onclick="closeModal()">OK</button></div>
    </div>
  </div>

<script>
/*
  AI Predictor demo
  - Plans: target ranges
  - Last 10 results input (manual)
  - AI analyze to suggest Bet/Skip + amount, with reasoning
  - Win/Loss reporting updates history & wallet
  - LocalStorage keys:
      ai_demo_wallet  : number
      ai_demo_history : array of last results (objects)
      ai_demo_decisions: array of last decisions (max 50)
*/

const PLANS = [
  { label: 'Target 100 → 250', targetMin:100, targetMax:250 },
  { label: 'Target 250 → 500', targetMin:250, targetMax:500 },
  { label: 'Target 500 → 1000', targetMin:500, targetMax:1000 },
  { label: 'Target 1000 → 2500', targetMin:1000, targetMax:2500 }
];

let selectedPlan = PLANS[0];
let wallet = 100;
let minBet = 10;
let last10 = new Array(10).fill(null); // each is 'BIG' or 'SMALL'
let currentSuggestion = null; // {action:'bet'|'skip', side:'BIG'|'SMALL', amount: number, confidence: 0-1, reason: string}
let currentPrediction = null; // {period, side, amount}
const MAX_DECISIONS = 50;

// DOM refs
const plansRow = document.getElementById('plansRow');
const inputBalance = document.getElementById('inputBalance');
const inputMinBet = document.getElementById('inputMinBet');
const btnToAI = document.getElementById('btnToAI');
const stepPlan = document.getElementById('step-plan');
const stepHistory = document.getElementById('step-history');
const historyGrid = document.getElementById('historyGrid');
const fillRandom = document.getElementById('fillRandom');
const btnAnalyze = document.getElementById('btnAnalyze');
const stepAI = document.getElementById('step-ai');
const aiSpinner = document.getElementById('aiSpinner');
const aiResult = document.getElementById('aiResult');
const aiSuggestion = document.getElementById('aiSuggestion');
const aiAmount = document.getElementById('aiAmount');
const aiConfidence = document.getElementById('aiConfidence');
const aiReason = document.getElementById('aiReason');
const btnGeneratePrediction = document.getElementById('btnGeneratePrediction');
const btnSkip = document.getElementById('btnSkip');
const walletEl = document.getElementById('wallet');
const predictionArea = document.getElementById('predictionArea');
const predText = document.getElementById('predText');
const periodLabel = document.getElementById('periodLabel');
const btnWin = document.getElementById('btnWin');
const btnLoss = document.getElementById('btnLoss');
const recentDecisions = document.getElementById('recentDecisions');
const btnBackToAnalyze = document.getElementById('btnBackToAnalyze');
const modalOverlay = document.getElementById('modalOverlay');
const modalTitle = document.getElementById('modalTitle');
const modalSub = document.getElementById('modalSub');

// init UI
function renderPlans(){
  plansRow.innerHTML = '';
  PLANS.forEach((p,idx)=>{
    const b = document.createElement('button');
    b.className = 'planBtn' + (idx===0 ? ' active' : '');
    b.innerText = p.label;
    b.onclick = ()=> {
      document.querySelectorAll('.planBtn').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      selectedPlan = p;
    };
    plansRow.appendChild(b);
  });
}
function renderHistoryGrid(){
  historyGrid.innerHTML = '';
  for(let i=0;i<10;i++){
    const cell = document.createElement('div');
    cell.className = 'resultCell' + (last10[i] ? ' active' : '');
    cell.dataset.index = i;
    cell.innerHTML = `<div style="font-weight:700">${i+1}</div><div style="margin-top:6px">${last10[i]||'—'}</div>`;
    cell.onclick = ()=> {
      // toggle: null -> BIG -> SMALL -> null
      const cur = last10[i];
      const next = cur === null ? 'BIG' : (cur === 'BIG' ? 'SMALL' : null);
      last10[i] = next;
      renderHistoryGrid();
    };
    historyGrid.appendChild(cell);
  }
}
function loadState(){
  const w = parseFloat(localStorage.getItem('ai_demo_wallet'));
  if(!isNaN(w)) wallet = w;
  const saved = JSON.parse(localStorage.getItem('ai_demo_history')||'null');
  if(Array.isArray(saved) && saved.length) last10 = saved.slice(0,10).concat(new Array(10-saved.length).fill(null)).slice(0,10);
  refreshWallet();
  renderHistoryGrid();
  renderDecisions();
}
function saveHistory(){
  localStorage.setItem('ai_demo_history', JSON.stringify(last10.filter(x=>x!==null)));
}
function saveWallet(){ localStorage.setItem('ai_demo_wallet', String(wallet)); }
function pushDecision(dec){
  const arr = JSON.parse(localStorage.getItem('ai_demo_decisions')||'[]');
  arr.unshift(dec);
  while(arr.length>MAX_DECISIONS) arr.pop();
  localStorage.setItem('ai_demo_decisions', JSON.stringify(arr));
  renderDecisions();
}
function renderDecisions(){
  const arr = JSON.parse(localStorage.getItem('ai_demo_decisions')||'[]');
  recentDecisions.innerHTML = arr.map(d=>{
    return `<div style="padding:6px 4px;border-bottom:1px solid rgba(255,255,255,0.03)"><strong>${d.action.toUpperCase()}</strong> ${d.side?'on '+d.side:''} • ₹${d.amount||0} • ${new Date(d.ts).toLocaleTimeString()} <div style="font-size:12px;color:${d.result?'#bfe':'#f6b6b6'}">${d.result?('Result: '+d.result):''}</div><div style="font-size:12px;color:#bfbfbf">${d.note||''}</div></div>`;
  }).join('') || '<div class="smallMuted">No decisions yet</div>';
}
function refreshWallet(){ walletEl.innerText = wallet.toFixed(2); saveWallet(); }

/* ------- navigation -------- */
btnToAI.onclick = ()=>{
  const b = parseFloat(inputBalance.value||'0');
  const mb = parseFloat(inputMinBet.value||'0');
  if(isNaN(b) || b<=0){ alert('Enter valid starting balance'); return; }
  if(isNaN(mb) || mb<=0){ alert('Enter valid min bet'); return; }
  wallet = b; minBet = mb;
  refreshWallet();
  stepPlan.style.display = 'none';
  stepHistory.style.display = 'block';
  stepAI.style.display = 'none';
  saveWallet(); saveHistory();
};

/* history grid actions */
fillRandom.onclick = ()=>{
  for(let i=0;i<10;i++) last10[i] = Math.random()<0.5?'BIG':'SMALL';
  renderHistoryGrid();
};

/* analyze -> run AI heuristics */
btnAnalyze.onclick = ()=>{
  // validate history: need at least 5 entries (or require exactly 10)
  const filled = last10.filter(x=>x!==null);
  if(filled.length < 5){ if(!confirm('Less than 5 entries filled. Continue analysis?')) return; }
  stepAI.style.display = 'block';
  aiResult.style.display = 'none';
  aiSpinner.style.display = 'block';
  predictionArea.style.display = 'none';
  // simulate thinking 1.2-2s
  setTimeout(()=>{
    currentSuggestion = aiAnalyze(last10, wallet, minBet);
    showAISuggestion(currentSuggestion);
    aiSpinner.style.display = 'none';
    aiResult.style.display = 'block';
  }, 1200 + Math.random()*800);
};

/* AI core: heuristics + strategy builder */
function aiAnalyze(historyArr, balance, minBet){
  // historyArr is array of 10 items (some may be null) oldest->newest
  const hist = historyArr.filter(x=>x!==null);
  const n = hist.length;
  const counts = { BIG:0, SMALL:0 };
  hist.forEach(h=>counts[h]++);
  const freqBig = counts.BIG / Math.max(1,n);
  const freqSmall = counts.SMALL / Math.max(1,n);
  // streak detection (ending streak)
  let last = hist[hist.length-1] || null;
  let streak = 0;
  for(let i=hist.length-1;i>=0;i--){
    if(hist[i]===last) streak++; else break;
  }
  // pattern detection: frequent double / triple patterns (simple)
  let pattern = null;
  if(n>=6){
    // check if last 3 equal to previous 3 etc
    const last3 = hist.slice(-3).join(',');
    const prev3 = hist.slice(-6,-3).join(',');
    if(last3 === prev3) pattern = 'repeat3';
  }

  // Basic scoring for side preference
  let preferred = freqBig > freqSmall ? 'BIG' : 'SMALL';
  let confidence = Math.abs(freqBig - freqSmall); // 0..1
  // adjust confidence with streaks and pattern
  confidence += Math.min(0.25, Math.max(0, (streak - 1) * 0.08));
  if(pattern==='repeat3') confidence += 0.12;
  confidence = Math.min(0.98, confidence);

  // strategy: decide bet or skip
  // If distribution strongly favors one side (>=0.65) -> bet that side
  // If confidence small (<0.18) -> skip
  // If balance low relative to minBet -> skip
  // Bet amount: base = max(minBet, round(balance * 0.05)) ; if streak length>2 and same side -> increase 1.5x
  let action = 'bet';
  if(confidence < 0.18 || n < 4) action = 'skip';
  if(balance < minBet * 1) action = 'skip';

  let base = Math.max(minBet, Math.round(balance * 0.05));
  let amount = base;
  if(streak >= 3) amount = Math.round(base * 1.5);
  if(confidence > 0.6) amount = Math.round(base * 1.6);
  if(amount < minBet) amount = minBet;
  if(amount > balance) amount = Math.max(minBet, Math.round(balance * 0.5));

  // If close counts (freq difference small) -> suggest skip
  const noteParts = [];
  noteParts.push(`History: BIG ${counts.BIG}, SMALL ${counts.SMALL} (${n} entries)`);
  if(streak>1) noteParts.push(`Recent streak: ${last} x${streak}`);
  if(pattern) noteParts.push(`Pattern detected: ${pattern}`);
  if(action==='skip') noteParts.push('AI suggests SKIP due low confidence or insufficient trend.');

  return {
    action,
    side: preferred,
    amount,
    confidence: Math.round(confidence*100),
    note: noteParts.join(' • ')
  };
}

function showAISuggestion(s){
  aiSuggestion.innerText = s.action === 'bet' ? `Bet on ${s.side}` : 'SKIP this round';
  aiAmount.innerText = '₹' + s.amount;
  aiConfidence.innerText = s.confidence + '%';
  aiReason.innerText = s.note;
}

/* Generate Prediction (user asks AI to produce one now) */
btnGeneratePrediction.onclick = ()=>{
  if(!currentSuggestion) return alert('Run analysis first.');
  if(currentSuggestion.action === 'skip'){
    showModal('AI Suggestion: SKIP','AI suggests skipping this round. You can still generate a prediction if you want.');
  }
  // create prediction object
  const nowPeriod = generateAutoPeriod();
  // pick side per suggestion (if skip and user forces generate, still pick preferred)
  const side = currentSuggestion.side;
  const amount = currentSuggestion.amount;
  currentPrediction = { period: nowPeriod, side, amount, ts: Date.now() };
  // show
  periodLabel.innerText = nowPeriod;
  predText.innerText = `${side} • ₹${amount}`;
  predictionArea.style.display = 'block';
  // log decision (pending result)
  pushDecision({ action: currentSuggestion.action, side, amount, ts: Date.now(), note: currentSuggestion.note });
};

/* Skip handling */
btnSkip.onclick = ()=>{
  // mark decision skip with note
  pushDecision({ action:'skip', side:null, amount:0, ts: Date.now(), note:'User followed AI skip' });
  showModal('Round Skipped','AI instructed to skip. After next round, please return and enter the actual result (Big/Small) so AI can learn.');
};

/* Win/Loss handling -> update wallet & history */
btnWin.onclick = ()=>{
  if(!currentPrediction) return showModal('No prediction','Generate a prediction first.');
  const amt = currentPrediction.amount;
  // define payout: simple assume win pays 1:1 (for demo). So wallet += amt
  wallet += amt;
  refreshWallet();
  // save result in history (push newest)
  shiftHistory(currentPrediction.side);
  // record decision with result
  pushDecision({ action:'bet', side: currentPrediction.side, amount: amt, ts: Date.now(), result:'WIN', note:'User reported WIN' });
  currentPrediction = null;
  predictionArea.style.display = 'none';
  saveHistory();
  showModal('Result recorded','WIN recorded. Wallet updated.');
  checkTargetComplete();
};

btnLoss.onclick = ()=>{
  if(!currentPrediction) return showModal('No prediction','Generate a prediction first.');
  const amt = currentPrediction.amount;
  // lose amount
  wallet -= amt;
  if(wallet < 0) wallet = 0;
  refreshWallet();
  shiftHistory(oppositeSide(currentPrediction.side));
  pushDecision({ action:'bet', side: currentPrediction.side, amount: amt, ts: Date.now(), result:'LOSS', note:'User reported LOSS' });
  currentPrediction = null;
  predictionArea.style.display = 'none';
  saveHistory();
  showModal('Result recorded','LOSS recorded. Wallet updated.');
};

/* helper: flip side */
function oppositeSide(s){ return s === 'BIG' ? 'SMALL' : 'BIG'; }

/* update history: maintain last10 as oldest->newest. When push new result, drop oldest and add */
function shiftHistory(resultSide){
  // shift left and append result at end
  last10.shift();
  last10.push(resultSide);
  renderHistoryGrid();
  saveHistory();
}

/* generate pseudo live period according to current datetime
   Format example from user: 20250914100011151 and increments every minute.
   We'll generate: YYYYMMDD + '1000' + sequence. For demo: use timestamp minutes since epoch modulo large number.
*/
function generateAutoPeriod(){
  // take current date and minute, build unique increasing number per minute
  const d = new Date();
  const YYYY = d.getFullYear().toString().padStart(4,'0');
  const MM = (d.getMonth()+1).toString().padStart(2,'0');
  const DD = d.getDate().toString().padStart(2,'0');
  const hh = d.getHours().toString().padStart(2,'0');
  const mm = d.getMinutes().toString().padStart(2,'0');
  // sequence part: use seconds of day / minute to get numeric tail
  const seq = String(Math.floor(d.getTime()/60000)).slice(-6); // last 6 digits of minute-timestamp
  return `${YYYY}${MM}${DD}1000${seq}`;
}

/* Back to analyze */
btnBackToAnalyze.onclick = ()=>{
  predictionArea.style.display = 'none';
};

/* modal util */
function showModal(title, sub=''){ modalOverlay.classList.add('show'); modalTitle.innerText = title; modalSub.innerText = sub; }
function closeModal(){ modalOverlay.classList.remove('show'); }

/* persist decisions & history upon unload */
window.addEventListener('beforeunload', ()=>{
  saveHistory();
  saveWallet();
});

// initial render
renderPlans();
renderHistoryGrid();
loadState();
renderDecisions();

// check target completion
function checkTargetComplete(){
  // if wallet falls within selected plan target range (>= targetMin and >= targetMax?), interpret as complete when wallet >= targetMax
  if(wallet >= (selectedPlan.targetMax || 999999)){
    showModal('🎉 Target Complete', `Your wallet reached ₹${wallet}. Target ${selectedPlan.label} complete!`);
    // reset to step 1 after short delay
    setTimeout(()=> {
      stepPlan.style.display = 'block';
      stepHistory.style.display = 'none';
      stepAI.style.display = 'none';
    }, 800);
  }
}
</script>
</body>
</html>
