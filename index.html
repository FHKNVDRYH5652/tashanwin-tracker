<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Smart Prediction Coach — Demo</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#071022; --card:#0f1724; --accent:#00d2a8; --accent2:#00a6ff; --muted:#9fb0d6;
  }
  *{box-sizing:border-box;font-family:'Poppins',sans-serif}
  body{margin:0;min-height:100vh;background:linear-gradient(180deg,#051021,#07142a);color:#eaf6ff;padding:18px}
  .wrap{max-width:980px;margin:0 auto}
  header{font-weight:800;font-size:1.4rem;padding:12px 0;text-align:center}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.03)}
  .row{display:flex;gap:12px;align-items:center}
  .col{display:flex;flex-direction:column;gap:8px}
  button{padding:10px 12px;border-radius:8px;border:none;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#002;font-weight:800;cursor:pointer}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:700}
  input, select{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
  .plans{display:flex;gap:12px;flex-wrap:wrap}
  .plan{padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);min-width:140px;text-align:center}
  .small{color:var(--muted);font-size:0.95rem}
  .history-box{background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;max-height:180px;overflow:auto}
  .prediction-panel{display:grid;grid-template-columns:1fr 300px;gap:12px}
  .badge{background:#0b2a24;padding:6px 10px;border-radius:999px;color:#aaffd9;font-weight:800}
  .big{color:#7fe8a7;font-weight:800}
  .smallSig{color:#ffcf8c;font-weight:800}
  .stat{font-weight:800}
  .center{text-align:center}
  .spinner{width:28px;height:28px;border-radius:50%;border:4px solid rgba(255,255,255,0.06);border-top-color:var(--accent);animation:spin 1s linear infinite;display:inline-block}
  @keyframes spin {to{transform:rotate(360deg)}}
  footer{margin-top:8px;color:var(--muted);font-size:0.9rem;text-align:center}
  .result-row{display:flex;gap:8px;flex-wrap:wrap}
  .result-pill{padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.04)}
</style>
</head>
<body>
<div class="wrap">
  <header>Smart Prediction Coach — AI Strategy Demo</header>

  <!-- Step 1: Choose plan (target) -->
  <section id="screen-choose" class="card">
    <h3>1) Choose a target plan</h3>
    <div class="small">Choose your starting balance target window. Example: "100 → 250" means you want to grow balance from 100 up to 250.</div>
    <div style="margin-top:12px" class="plans">
      <div class="plan">
        <div style="font-weight:800">100 → 250</div>
        <div class="small">Safe starter</div>
        <div style="margin-top:8px"><button onclick="choosePlan(100,250)">Select</button></div>
      </div>
      <div class="plan">
        <div style="font-weight:800">200 → 500</div>
        <div class="small">Aggressive</div>
        <div style="margin-top:8px"><button onclick="choosePlan(200,500)">Select</button></div>
      </div>
      <div class="plan">
        <div style="font-weight:800">500 → 1200</div>
        <div class="small">Pro</div>
        <div style="margin-top:8px"><button onclick="choosePlan(500,1200)">Select</button></div>
      </div>
    </div>
    <div style="margin-top:12px" class="small">You can also enter custom values:</div>
    <div style="margin-top:8px" class="row">
      <input id="customStart" placeholder="Start (e.g. 100)" type="number">
      <input id="customTarget" placeholder="Target (e.g. 250)" type="number">
      <button onclick="chooseCustom()">Choose</button>
    </div>
  </section>

  <!-- Step 2: Provide last-10 results -> AI analysis -->
  <section id="screen-input" class="card" style="display:none">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3>2) Enter last 10 results (earliest → latest)</h3>
      <div class="small">Plan: <span id="planLabel" class="stat"></span></div>
    </div>

    <div class="small">Click each box to toggle Big / Small. When finished press <b>Analyze</b>.</div>
    <div style="margin-top:12px" id="last10" class="row"></div>

    <div style="margin-top:12px" class="row">
      <button onclick="analyze()">Analyze & Get Strategy</button>
      <button class="btn-ghost" onclick="goBack()">Back</button>
      <div style="margin-left:auto" id="balanceInfo" class="small"></div>
    </div>

    <div style="margin-top:12px" class="small">Saved history helps the AI improve suggestions over time (stored locally).</div>
  </section>

  <!-- Step 3: AI & live interaction -->
  <section id="screen-ai" class="card" style="display:none">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3>3) Coach Recommendation</h3>
      <div><span class="badge" id="targetBadge"></span></div>
    </div>

    <div style="margin-top:12px" class="prediction-panel">
      <div>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="small">Current balance</div>
            <div style="font-size:1.6rem;font-weight:900" id="balanceDisplay">-</div>
            <div class="small" id="progressText"></div>
          </div>
          <div class="center">
            <div class="small">AI confidence</div>
            <div id="confidenceDisplay" style="font-weight:900">-</div>
            <div id="analysisSpinner" style="margin-top:8px;display:none"><span class="spinner"></span></div>
          </div>
        </div>

        <hr style="margin:12px 0;border:0;border-top:1px solid rgba(255,255,255,0.03)">

        <div>
          <div class="small">AI Suggestion</div>
          <div style="margin-top:8px">
            <div id="aiAdvice" style="font-size:1.05rem;font-weight:800">—</div>
            <div class="small" id="aiReason" style="margin-top:6px;color:var(--muted)"></div>
            <div style="margin-top:8px">
              <div class="small">Suggested amount</div>
              <div id="suggestedAmount" style="font-weight:900;font-size:1.2rem">-</div>
            </div>
          </div>
        </div>

        <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
          <button onclick="markOutcome('win')">Win ✅</button>
          <button onclick="markOutcome('loss')">Loss ❌</button>
          <button class="btn-ghost" onclick="markOutcome('skip')">Skip ⏭</button>
          <div style="margin-left:auto" class="small">Last analysis <span id="lastAnalysisTime">—</span></div>
        </div>

        <div style="margin-top:12px">
          <div class="small">Strategy notes</div>
          <div id="strategyNotes" class="small" style="margin-top:6px;color:var(--muted)"></div>
        </div>
      </div>

      <!-- Right column: history, results, stats -->
      <div>
        <div class="small">AI saved history (global for this browser)</div>
        <div style="margin-top:8px" class="history-box" id="historyBox"></div>

        <div style="margin-top:12px">
          <div class="small">Last results (most recent first)</div>
          <div style="margin-top:8px" id="lastResults" class="history-box"></div>
        </div>

        <div style="margin-top:12px">
          <div class="small">Stats</div>
          <div style="margin-top:8px">
            <div>Wins: <span id="statWins">0</span></div>
            <div>Losses: <span id="statLosses">0</span></div>
            <div>Accuracy: <span id="statAcc">0%</span></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer>Local demo — all data stored in your browser. You can export/import later.</footer>
</div>

<script>
/*
  Smart Prediction Coach (client-only prototype)
  - Not a real ML model. Uses heuristics:
    * frequency, streaks, recency weighting, "psychology" bias detection
    * bet sizing: proportional + adjustable risk
    * suggests "skip" when low confidence
  - History stored in localStorage under keys:
    - spc_history: array of past predictions {period, side, result, amt, ts}
    - spc_stats: wins/losses counts
  - Flow: choose plan -> enter last 10 -> analyze -> show suggestion -> mark outcome -> iterate
*/

// ---------------- state ----------------
let startBalance = 100, targetBalance = 250;
let balance = 0;
let last10 = []; // earliest -> latest array of "Big" or "Small"
let spc_history = []; // saved interactions
let stats = {wins:0, losses:0};
let lastSuggestion = null;

// ---------------- localStorage helpers ----------------
function loadState(){
  try{
    spc_history = JSON.parse(localStorage.getItem('spc_history')||'[]');
    stats = JSON.parse(localStorage.getItem('spc_stats')||'{"wins":0,"losses":0}');
  }catch(e){ spc_history=[]; stats={wins:0,losses:0}; }
}
function saveState(){
  localStorage.setItem('spc_history', JSON.stringify(spc_history));
  localStorage.setItem('spc_stats', JSON.stringify(stats));
}

// ---------------- UI helpers ----------------
function show(id){ document.getElementById(id).style.display = 'block' }
function hide(id){ document.getElementById(id).style.display = 'none' }
function choosePlan(start, target){
  startBalance = Number(start); targetBalance = Number(target);
  balance = startBalance;
  document.getElementById('planLabel').innerText = startBalance + ' → ' + targetBalance;
  document.getElementById('targetBadge').innerText = `${startBalance} → ${targetBalance}`;
  setupLast10UI();
  hide('screen-choose'); show('screen-input');
}
function chooseCustom(){
  const a = Number(document.getElementById('customStart').value||0);
  const b = Number(document.getElementById('customTarget').value||0);
  if(!a || !b || b<=a){ alert('Enter valid start & target (target > start)'); return; }
  choosePlan(a,b);
}
function goBack(){
  show('screen-choose'); hide('screen-input'); hide('screen-ai');
}

// ---------------- last10 UI ----------------
function setupLast10UI(){
  const container = document.getElementById('last10');
  container.innerHTML = '';
  last10 = [];
  for(let i=0;i<10;i++){
    last10.push('Big'); // default
    const btn = document.createElement('button');
    btn.className = 'btn-ghost';
    btn.innerText = 'Big';
    btn.style.minWidth='80px';
    btn.dataset.idx=i;
    btn.onclick = ()=>{ toggleLastBtn(btn) }
    container.appendChild(btn);
  }
  document.getElementById('balanceInfo').innerText = `Balance: ₹${startBalance}`;
}
function toggleLastBtn(btn){
  const idx = Number(btn.dataset.idx);
  last10[idx] = (last10[idx] === 'Big') ? 'Small' : 'Big';
  btn.innerText = last10[idx];
}

// ---------------- analysis (our "AI") ----------------
function analyze(){
  // UI spinner
  document.getElementById('analysisSpinner').style.display = 'inline-block';
  document.getElementById('analysisSpinner').scrollIntoView({behavior:'smooth', block:'center'});

  // Build weighted counts: recent results get higher weight
  const weights = [0.5,0.6,0.7,0.8,0.9,1,1.1,1.25,1.5,2]; // earliest->latest
  const counts = {Big:0, Small:0};
  for(let i=0;i<10;i++){
    counts[last10[i]] += weights[i];
  }
  // detect streaks and bias
  const last = last10[last10.length-1];
  const streakLen = computeStreak(last10);
  const bias = (counts.Big - counts.Small); // positive -> Big favored
  const totalWeight = weights.reduce((s,a)=>s+a,0);
  const bigProb = (counts.Big/totalWeight);
  const smallProb = (counts.Small/totalWeight);
  const confidence = Math.abs(bigProb - smallProb); // 0..1 smaller->low confidence
  // determine suggested side
  let suggestedSide = (bigProb >= smallProb) ? 'Big' : 'Small';
  // Psychology heuristic: if there's a long streak of same side, contrarian or continuation?
  // We'll prefer continuation for short streaks (<4), and contrarian for very long (>5)
  if(streakLen >= 5){
    // contrarian
    suggestedSide = (last === 'Big') ? 'Small' : 'Big';
  } else if(streakLen >= 3 && confidence < 0.15){
    // low confidence but a short streak -> may skip
    // leave suggestedSide but reduce confidence
  }

  // Bet sizing heuristic:
  // baseRisk = 0.03 of balance when confident; scale by confidence
  balance = Number(document.getElementById('balanceDisplay').dataset.val || startBalance);
  if(!balance || isNaN(balance)) balance = startBalance;
  const baseFraction = 0.03; // 3%
  let suggestedAmount = Math.max(1, Math.round(balance * baseFraction * (0.5 + confidence*2))); // scaled by confidence
  // if suggested amount > remaining to target, clamp
  const remaining = Math.max(0, targetBalance - balance);
  if(suggestedAmount > remaining) suggestedAmount = Math.min(remaining, suggestedAmount);

  // Low confidence -> maybe skip
  let adviceType = 'bet';
  if(confidence < 0.06 || Math.max(bigProb, smallProb) < 0.52) {
    adviceType = 'skip';
  }

  // Compose explanation
  const reason = [];
  reason.push(`Bias: Big ${bigProb.toFixed(2)} vs Small ${smallProb.toFixed(2)}`);
  reason.push(`Recent streak: ${streakLen} (${last})`);
  if(adviceType==='skip') reason.push('Low confidence — suggest skipping this period');
  else reason.push('Confidence sufficient — suggest betting');

  // store lastSuggestion and show in UI after a short simulated delay (approx 1s)
  lastSuggestion = {
    side: suggestedSide,
    amount: suggestedAmount,
    confidence: (confidence*100).toFixed(0),
    adviceType,
    reason: reason.join('. ')
  };

  setTimeout(()=>{
    document.getElementById('analysisSpinner').style.display = 'none';
    showAIAdvice();
    // show ai history summary
    renderHistory();
  }, 900); // simulated analysis time (under 2s)
}

function computeStreak(arr){
  if(!arr || !arr.length) return 0;
  const last = arr[arr.length-1];
  let c=0;
  for(let i=arr.length-1;i>=0;i--){
    if(arr[i]===last) c++; else break;
  }
  return c;
}

// ---------------- show AI advice ----------------
function showAIAdvice(){
  if(!lastSuggestion) return;
  show('screen-ai'); hide('screen-input');
  // set displays
  document.getElementById('balanceDisplay').innerText = `₹${balance}`;
  document.getElementById('balanceDisplay').dataset.val = balance;
  document.getElementById('confidenceDisplay').innerText = `${lastSuggestion.confidence}%`;
  document.getElementById('aiAdvice').innerText = (lastSuggestion.adviceType==='skip') ? `SKIP this period` : `${lastSuggestion.side} • Bet`;
  document.getElementById('aiReason').innerText = lastSuggestion.reason;
  document.getElementById('suggestedAmount').innerText = (lastSuggestion.adviceType==='skip') ? '—' : `₹${lastSuggestion.amount}`;
  document.getElementById('lastAnalysisTime').innerText = new Date().toLocaleTimeString();
  computeAndRenderStats();
}

// ---------------- mark outcome (user presses Win / Loss / Skip) ----------------
function markOutcome(result){
  // result: 'win' 'loss' 'skip'
  if(!lastSuggestion && result!=='skip'){
    alert('No suggestion exists yet. Click Analyze first.');
    return;
  }
  const period = new Date().toISOString(); // synthetic period id; could be customized
  const rec = {
    period,
    side: lastSuggestion ? lastSuggestion.side : null,
    amt: lastSuggestion ? lastSuggestion.amount : 0,
    advice: lastSuggestion ? lastSuggestion.adviceType : 'skip',
    result, ts: Date.now()
  };
  // update balance & stats
  if(result === 'win'){
    // assume winning gives equal amount as profit (for demo): add amt
    balance += (rec.amt || 0);
    stats.wins = (stats.wins||0) + 1;
  } else if(result === 'loss'){
    balance -= (rec.amt || 0);
    if(balance < 0) balance = 0;
    stats.losses = (stats.losses||0) + 1;
  } else if(result === 'skip'){
    // no balance change
  }
  // apply rounding
  balance = Math.round(balance);
  // push to history (keep last 200 entries)
  spc_history.unshift(rec);
  if(spc_history.length>200) spc_history = spc_history.slice(0,200);
  saveState();
  // update UI
  document.getElementById('balanceDisplay').innerText = `₹${balance}`;
  document.getElementById('balanceDisplay').dataset.val = balance;
  renderHistory();
  computeAndRenderStats();
  // re-analyze quickly using last saved history + last10
  // update last10 shift: append actual observed result (Big/Small) if available
  // For demo, if user reported win and lastSuggestion.side exists, we treat actual outcome = that side (this sim uses user feedback)
  if(lastSuggestion && (result === 'win' || result === 'loss')){
    // If win -> outcome matched side. If loss -> opposite.
    const actual = (result==='win') ? lastSuggestion.side : (lastSuggestion.side==='Big' ? 'Small' : 'Big');
    // shift last10 left and push actual
    last10.shift(); last10.push(actual);
    // reflect on UI last10 buttons if screen-input visible later
  }
  // check completed target
  if(balance >= targetBalance){
    setTimeout(()=> {
      alert('🎉 Congratulations — Your target complete!');
      // reset to initial screen
      resetToStart();
    }, 250);
  }
  // re-run analyze automatically to provide next suggestion
  lastSuggestion = null;
  setTimeout(()=> analyze(), 500);
}

// ---------------- render history & stats ----------------
function renderHistory(){
  // history summary (most recent first)
  const box = document.getElementById('historyBox');
  box.innerHTML = '';
  const grouped = spc_history.slice(0,50); // show latest 50
  grouped.forEach(h=>{
    const d = document.createElement('div');
    d.style.padding='6px 4px';
    d.style.borderBottom='1px solid rgba(255,255,255,0.03)';
    d.innerHTML = `<div style="display:flex;justify-content:space-between">
      <div style="font-size:13px">${h.advice || '-'} ${h.side || '-'} ${h.amt?('₹'+h.amt):''}</div>
      <div style="font-size:12px;color:#bbb">${new Date(h.ts).toLocaleTimeString()} • ${h.result}</div>
    </div>`;
    box.appendChild(d);
  });

  // lastResults (last10)
  const lr = document.getElementById('lastResults');
  lr.innerHTML = '';
  if(last10.length){
    const row = document.createElement('div');
    row.className='result-row';
    last10.slice().reverse().forEach(r=>{
      const pill = document.createElement('div');
      pill.className='result-pill';
      pill.innerText = r;
      if(r==='Big') pill.style.borderLeft = '4px solid #7fe8a7';
      else pill.style.borderLeft = '4px solid #ffcf8c';
      row.appendChild(pill);
    });
    lr.appendChild(row);
  }
}

// ---------------- stats compute ----------------
function computeAndRenderStats(){
  const wins = stats.wins||0, losses=stats.losses||0, total = wins+losses;
  const acc = total ? Math.round((wins/total)*100) : 0;
  document.getElementById('statWins').innerText = wins;
  document.getElementById('statLosses').innerText = losses;
  document.getElementById('statAcc').innerText = acc + '%';
  // progress
  document.getElementById('progressText').innerText = `Target: ${startBalance} → ${targetBalance} • Remaining: ₹${Math.max(0, targetBalance-balance)}`;
  // historyBox already updated
}

// ---------------- reset to start ----------------
function resetToStart(){
  // clear session variables except saved global history & stats
  last10 = [];
  spc_history = spc_history || [];
  stats = stats || {wins:0,losses:0};
  saveState();
  document.getElementById('screen-ai').style.display = 'none';
  document.getElementById('screen-input').style.display = 'none';
  document.getElementById('screen-choose').style.display = 'block';
  // reset displays
  document.getElementById('balanceDisplay').dataset.val = startBalance;
}

// ---------------- init ----------------
function init(){
  loadState();
  // initial defaults
  document.getElementById('balanceDisplay').dataset.val = startBalance;
  // route: show choose screen
  hide('screen-input'); hide('screen-ai');
  show('screen-choose');
  renderHistory();
  computeAndRenderStats();
}
init();

</script>
</body>
</html>
