<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WINGO AI Predictor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: black;
      color: #00ffcc;
      font-family: 'Courier New', monospace;
      padding: 20px;
    }
    h1 {
      text-align: center;
      animation: glow 2s infinite;
    }
    @keyframes glow {
      0%, 100% { text-shadow: 0 0 5px #00ffcc; }
      50% { text-shadow: 0 0 20px #00ffcc; }
    }
    input, button {
      padding: 10px;
      margin: 10px auto;
      display: block;
      font-size: 16px;
      border-radius: 8px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #00ffcc;
      padding: 8px;
      text-align: center;
    }
    .prediction, .analysis {
      margin-top: 20px;
      font-size: 18px;
      text-align: center;
    }
    #accessScreen {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: black;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 9999;
    }
    canvas {
      background: #111;
      border-radius: 10px;
      margin-top: 30px;
    }
  </style>
</head>
<body>

<div id="accessScreen">
  <h2 style="color:#0f0;">Enter Access Key</h2>
  <input type="password" id="accessKey" placeholder="Enter key...">
  <button onclick="checkKey()">Unlock</button>
</div>

<div style="display:none" id="mainApp">
  <h1>WINGO AI Predictor</h1>
  <input type="file" accept="image/*" id="imageInput">
  <button onclick="processImage()">Analyze Screenshot</button>
  <div id="ocrText" style="white-space:pre-wrap;color:#ccc;margin-top:10px;font-size:14px;"></div>
  <div id="status" style="color:yellow;margin-top:5px;"></div>

  <div class="prediction" id="result"></div>
  <div class="analysis" id="analysis"></div>
  <table id="outputTable"></table>
  <canvas id="trendChart" width="400" height="150"></canvas>
  <audio id="ping" src="https://assets.mixkit.co/sfx/preview/mixkit-classic-click-1117.mp3"></audio>
</div>

<script>
let memory = [];

function checkKey() {
  const key = document.getElementById("accessKey").value;
  if (key === "Mrperfect456") {
    document.getElementById("accessScreen").style.display = "none";
    document.getElementById("mainApp").style.display = "block";
  } else {
    alert("Invalid Key");
  }
}

function processImage() {
  const file = document.getElementById('imageInput').files[0];
  if (!file) return alert("Please upload a screenshot");

  document.getElementById('status').innerText = 'ðŸ§  OCR in progress...';

  Tesseract.recognize(file, 'eng').then(({ data: { text } }) => {
    document.getElementById('ocrText').innerText = text;
    document.getElementById('status').innerText = 'âœ… OCR done. Analyzing...';

    const lines = text.split("\n").filter(line => /\d{6,18}/.test(line) && /\d/.test(line));
    if (lines.length === 0) {
      document.getElementById('status').innerText = 'âŒ No valid lines found. Try uploading a clearer screenshot.';
      return;
    }

    const data = lines.map(line => {
      const match = line.match(/(\d{6,18})\D*(\d)/);
      if (match) return { period: match[1], number: parseInt(match[2]) };
    }).filter(Boolean).slice(0, 15); // Take top 15 (latest on top)

    const table = document.getElementById("outputTable");
    table.innerHTML = "<tr><th>Period</th><th>Number</th><th>Big/Small</th><th>Color</th></tr>" +
      data.map(d => {
        const size = d.number >= 5 ? "Big" : "Small";
        const color = [0,2,4,6,8].includes(d.number) ? 'Red' : 'Green';
        return `<tr><td>${d.period}</td><td>${d.number}</td><td>${size}</td><td>${color}</td></tr>`;
      }).join('');

    const numbers = data.map(d => d.number);
    const last5 = numbers.slice(0, 5);
    const bigCount = last5.filter(n => n >= 5).length;
    const smallCount = last5.length - bigCount;

    const freq = Array(10).fill(0);
    numbers.forEach(n => freq[n]++);
    const mostFrequent = freq.indexOf(Math.max(...freq));

    const sizePattern = bigCount >= 4 ? "Big" : smallCount >= 4 ? "Small" : "Mixed";
    let predictedNumber;

    if (sizePattern === "Big") {
      predictedNumber = Math.min(9, numbers[0] + 1);
    } else if (sizePattern === "Small") {
      predictedNumber = Math.max(0, numbers[0] - 1);
    } else {
      predictedNumber = (mostFrequent + 1) % 10;
    }

    const predictedSize = predictedNumber >= 5 ? "Big" : "Small";
    const predictedColor = [0,2,4,6,8].includes(predictedNumber) ? 'Red' : 'Green';
    const confidence = 60 + (sizePattern !== "Mixed" ? 20 : 0);

    const nextPeriod = (BigInt(data[0].period) + 1n).toString();

    document.getElementById("result").innerHTML = `
      <b>Next Period:</b> ${nextPeriod}<br>
      <b>Prediction:</b> ${predictedNumber} - ${predictedSize} - ${predictedColor}<br>
      <b>Confidence:</b> ${confidence}%
    `;

    document.getElementById("analysis").innerText = `Pattern Detected: ${sizePattern} | Most Repeated Number: ${mostFrequent} | Recent Trend: ${bigCount} Big / ${smallCount} Small`;

    document.getElementById("ping").play();

    const ctx = document.getElementById('trendChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: numbers.map((_, i) => `#${i+1}`),
        datasets: [{
          label: 'Number Trend',
          data: numbers,
          backgroundColor: numbers.map(n => n >= 5 ? 'rgba(0,255,0,0.6)' : 'rgba(255,0,0,0.6)')
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true,
            max: 9
          }
        }
      }
    });
  });
}
</script>

</body>
</html>
